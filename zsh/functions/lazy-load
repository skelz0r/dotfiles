# Lazy loading for version managers
# Adds shims to PATH immediately, defers full init until needed

# Rbenv - add shims to PATH immediately
if [[ -d "$HOME/.rbenv/shims" ]]; then
  path=("$HOME/.rbenv/shims" $path)
fi

# Pyenv - add shims to PATH immediately
if [[ -d "$PYENV_ROOT/shims" ]]; then
  path=("$PYENV_ROOT/shims" $path)
fi

# NVM - lazy load (no shims, must load fully)
_nvm_loaded=0
_load_nvm() {
  (( _nvm_loaded )) && return
  _nvm_loaded=1
  unset -f nvm 2>/dev/null
  [[ -s "/opt/homebrew/opt/nvm/nvm.sh" ]] && source "/opt/homebrew/opt/nvm/nvm.sh"
  [[ -s "/usr/local/opt/nvm/nvm.sh" ]] && source "/usr/local/opt/nvm/nvm.sh"
  [[ -s "$NVM_DIR/nvm.sh" ]] && source "$NVM_DIR/nvm.sh"
}

nvm() { _load_nvm; nvm "$@"; }

# Rbenv init - lazy (shims already in PATH)
_rbenv_inited=0
rbenv() {
  if (( ! _rbenv_inited )); then
    _rbenv_inited=1
    unset -f rbenv 2>/dev/null
    eval "$(command rbenv init - --no-rehash zsh)"
  fi
  command rbenv "$@"
}

# Pyenv init - lazy (shims already in PATH)
_pyenv_inited=0
pyenv() {
  if (( ! _pyenv_inited )); then
    _pyenv_inited=1
    unset -f pyenv 2>/dev/null
    eval "$(command pyenv init -)"
  fi
  command pyenv "$@"
}
