#!/usr/bin/env bash

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source "$SCRIPT_DIR/lib/common.sh"

usage() {
  cat << EOF
Usage: $(basename "$0") <project>

SSH to remote desktop and run tat on project (auto-detects local/remote).

Arguments:
  project    Project path (e.g., dinum/siade)

Options:
  -h, --help    Show this help message

Examples:
  $(basename "$0") dinum/siade
  $(basename "$0") perso/dotfiles
EOF
  exit 0
}

[[ "${1:-}" == "-h" || "${1:-}" == "--help" ]] && usage

if [[ -z "${1:-}" ]]; then
  echo "Error: project argument required" >&2
  usage
fi

PROJECT="$1"
HOST=$(detect_host)
PROJECT_NAME=$(basename "$PROJECT")
echo -ne "\033]0;r $PROJECT_NAME\007"
ssh -t "$HOST" "cd ~/work/$PROJECT && PATH=\"\$PATH:/opt/homebrew/bin\" ~/.bin/tat"
